<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Project – Airplane Model</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- three.js + loaders -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>

  <style>
    .slide-layer{position:absolute;inset:0;opacity:0;transition:opacity .8s ease}
    .slide-layer.active{opacity:1;position:relative}
    .dot.active{background-color:rgba(255,255,255,.9)}
    #viewer{
      min-height: 420px;height: 420px;background:#60646e22;border-radius:16px;
      border:1px solid rgba(0,0,0,.08); overflow:hidden; position:relative;
    }
    #status{
      position:absolute;left:12px;bottom:12px;background:rgba(0,0,0,.55);
      color:#fff;padding:6px 10px;border-radius:8px;font-size:12px;z-index:2
    }
  </style>
</head>
<body class="bg-white text-black font-sans">
  <main class="max-w-6xl mx-auto px-6 py-10">
    <a href="index.html" class="text-blue-600 hover:underline">&larr; Back</a>
    <h1 class="text-3xl font-semibold mt-4 mb-2">Airplane Model</h1>
    <p class="text-neutral-600 mb-8">
      Smooth-surfaced airplane assembly cleaned for real-time viewing. Explore the model interactively and
      browse renders below.
    </p>

    <div class="grid sm:grid-cols-2 gap-8">
      <!-- 3D Viewer -->
      <div id="viewer" class="flex items-center justify-center">
        <div id="status">Initializing renderer…</div>
      </div>

      <!-- Image Slider -->
      <div id="slider" class="relative overflow-hidden rounded-2xl">
        <div class="slide-layer active">
          <img src="assets/images/Airplane Model1.jpg" class="w-full object-cover" alt="Airplane render 1"/>
        </div>
        <div class="slide-layer">
          <img src="assets/images/Airplane Model2.jpg" class="w-full object-cover" alt="Airplane render 2"/>
        </div>
        <div class="slide-layer">
          <img src="assets/images/Airplane Model3.jpg" class="w-full object-cover" alt="Airplane render 3"/>
        </div>
        <div class="dots flex justify-center gap-2 absolute bottom-3 w-full">
          <span class="dot active w-2 h-2 rounded-full bg-black/60"></span>
          <span class="dot w-2 h-2 rounded-full bg-black/40"></span>
          <span class="dot w-2 h-2 rounded-full bg-black/40"></span>
        </div>
      </div>
    </div>
  </main>

  <script>
    // ---------- 3D VIEWER with status + placeholder ----------
    (function initViewer(){
      const wrap = document.getElementById('viewer');
      const status = document.getElementById('status');
      const w = wrap.clientWidth, h = wrap.clientHeight;

      const scene = new THREE.Scene();
      scene.background = null;

      const camera = new THREE.PerspectiveCamera(50, w/h, 0.1, 1000);
      camera.position.set(0, 0.8, 4.5);

      const renderer = new THREE.WebGLRenderer({ antialias:true, alpha:true });
      renderer.outputColorSpace = THREE.SRGBColorSpace;
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setSize(w, h);
      wrap.appendChild(renderer.domElement);

      const hemi = new THREE.HemisphereLight(0xffffff, 0x404040, 1.2);
      scene.add(hemi);
      const dir = new THREE.DirectionalLight(0xffffff, 0.9);
      dir.position.set(3, 4, 5);
      scene.add(dir);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;

      // Placeholder cube to confirm rendering works
      const phGeo = new THREE.BoxGeometry(0.6,0.6,0.6);
      const phMat = new THREE.MeshStandardMaterial({color:0x8ea0ff, metalness:.2, roughness:.5});
      const placeholder = new THREE.Mesh(phGeo, phMat);
      placeholder.position.set(-999, -999, -999); // hidden until we need it
      scene.add(placeholder);

      const clock = new THREE.Clock();
      function tick(){
        if(placeholder.visible){ placeholder.rotation.y += 0.01; }
        controls.update();
        renderer.render(scene, camera);
        requestAnimationFrame(tick);
      }
      tick();

      // Load GLB
      const loader = new THREE.GLTFLoader();
      // IMPORTANT: path is case-sensitive and relative to project.html
      const modelPath = encodeURI('./assets/models/AIR_PLANE_CLEAN.glb');
      status.textContent = 'Loading model… ' + decodeURI(modelPath);
      console.log('[GLB] loading:', modelPath);

      // If model fails to load, show spinning cube to verify renderer
      let model = null;
      placeholder.visible = true; placeholder.position.set(0,0,0);

      loader.load(
        modelPath,
        (gltf)=>{
          status.textContent = 'Model loaded. Framing…';
          model = gltf.scene;
          placeholder.visible = false; placeholder.position.set(-999,-999,-999);
          scene.add(model);

          // auto frame
          const box = new THREE.Box3().setFromObject(model);
          const size = box.getSize(new THREE.Vector3()).length();
          const center = box.getCenter(new THREE.Vector3());
          const fitDist = size / (2 * Math.tan(THREE.MathUtils.degToRad(camera.fov) / 2));
          camera.position.copy(center).add(new THREE.Vector3(0, size*0.15, fitDist*1.1));
          camera.near = size/100;
          camera.far = size*100;
          camera.updateProjectionMatrix();
          controls.target.copy(center);
          controls.update();

          status.textContent = 'Ready';
          setTimeout(()=>status.remove(), 1200);
        },
        (xhr)=>{
          // progress
          if (xhr.total) {
            const p = Math.round((xhr.loaded / xhr.total) * 100);
            status.textContent = `Loading model… ${p}%`;
          }
        },
        (err)=>{
          console.error('[GLB] error:', err);
          status.textContent = 'Failed to load model (check path/case). See console.';
          // keep placeholder visible so we confirm WebGL works
          placeholder.visible = true; placeholder.position.set(0,0,0);
        }
      );

      window.addEventListener('resize', ()=>{
        const W = wrap.clientWidth, H = wrap.clientHeight;
        camera.aspect = W/H; camera.updateProjectionMatrix();
        renderer.setSize(W, H);
      });
    })();

    // ---------- Slider ----------
    (function slider(){
      const slides = document.querySelectorAll('.slide-layer');
      const dots = document.querySelectorAll('.dot');
      let i = 0;
      function show(n){
        slides.forEach((s,k)=>s.classList.toggle('active', k===n));
        dots.forEach((d,k)=>d.classList.toggle('active', k===n));
      }
      setInterval(()=>{ i = (i+1)%slides.length; show(i); }, 4000);
    })();
  </script>
</body>
</html>
