<!doctype html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project</title><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="style.css">
</head><body class="font-sans"><div class="container">
<a href="index.html" class="text-sm text-indigo-300 hover:text-indigo-200">← Back</a>
<h1 id="title" class="text-3xl font-semibold mt-3">Project</h1>
<p id="desc" class="text-slate-300 mt-2"></p>
<div class="grid md:grid-cols-2 gap-6 mt-6">
  <div class="card p-3 viewer-wrap"><div id="viewer" class="w-full h-[420px] md:h-[520px] rounded-xl overflow-hidden"></div></div>
  <div class="card p-3"><div id="mediaSlider" class="slider rounded-xl overflow-hidden"></div><div id="dots" class="flex gap-2 justify-center mt-3"></div></div>
</div>
<p id="long" class="text-slate-300 mt-6"></p><div id="tags" class="flex flex-wrap gap-2 mt-3"></div></div>
<script type="module">
  import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160/build/three.module.js";
  import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/controls/OrbitControls.js";
  import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.160/examples/jsm/loaders/GLTFLoader.js";
  const $=s=>document.querySelector(s); const params=new URLSearchParams(location.search); const slug=params.get('slug');
  const projects=await fetch('projects.json').then(r=>r.json()); const proj=projects.find(p=>p.slug===slug);
  if(!proj){$("#title").textContent="Project not found";throw new Error("slug not found");}
  $("#title").textContent=proj.title; $("#desc").textContent=proj.description||""; $("#long").textContent=proj.longDescription||"";
  $("#tags").innerHTML=(proj.tags||[]).map(t=>`<span class="badge">${t}</span>`).join("");

  const media=[...(proj.images||[]).map(src=>({type:"img",src})),...(proj.videos||[]).map(src=>({type:"video",src}))];
  const slider=$("#mediaSlider"), dotsWrap=$("#dots"); let idx=0;
  function renderSlider(){ slider.innerHTML=""; media.forEach((m,i)=>{ const el=document.createElement(m.type==="img"?"img":"video"); el.className="slide w-full rounded-xl";
    if(m.type==="img"){el.src=m.src; el.loading="lazy"; el.style.maxHeight="520px"; el.style.objectFit="cover";}
    else{el.src=m.src; el.controls=true; el.playsInline=true; el.style.maxHeight="520px"; el.style.width="100%";}
    if(i===idx) el.classList.add("active"); slider.appendChild(el); });
    if(media.length>1){ const L=Object.assign(document.createElement("div"),{className:"ctrl left",textContent:"‹"});
      const R=Object.assign(document.createElement("div"),{className:"ctrl right",textContent:"›"}); L.onclick=()=>{idx=(idx-1+media.length)%media.length;renderSlider()};
      R.onclick=()=>{idx=(idx+1)%media.length;renderSlider()}; slider.append(L,R); }
    dotsWrap.innerHTML=""; media.forEach((_,i)=>{ const d=Object.assign(document.createElement("div"),{className:"dot"+(i===idx?" active":"")}); d.onclick=()=>{idx=i;renderSlider()}; dotsWrap.appendChild(d);});
  } renderSlider();

  const viewer=$("#viewer");
  if(!proj.model){ viewer.innerHTML = '<div class="w-full h-full grid place-items-center text-slate-400">No 3D model</div>'; }
  else{
    const scene=new THREE.Scene(); scene.background=new THREE.Color(0x0b1220);
    const renderer=new THREE.WebGLRenderer({antialias:true,powerPreference:"high-performance"}); viewer.appendChild(renderer.domElement);
    const camera=new THREE.PerspectiveCamera(50,1,0.1,1000); camera.position.set(2.5,1.6,3.0);
    const controls=new OrbitControls(camera,renderer.domElement); controls.enableDamping=true;
    const hemi=new THREE.HemisphereLight(0xffffff,0x222244,1.05); scene.add(hemi);
    const dir=new THREE.DirectionalLight(0xffffff,1.0); dir.position.set(3,5,7); scene.add(dir);
    const grid=new THREE.GridHelper(10,10,0x334,0x112); grid.material.opacity=.25; grid.material.transparent=true; scene.add(grid);
    function resize(){ const w=viewer.clientWidth||600, h=viewer.clientHeight||420; renderer.setSize(w,h,false); camera.aspect=w/h; camera.updateProjectionMatrix();}
    resize(); new ResizeObserver(resize).observe(viewer);
    const loader=new GLTFLoader(); const modelURL=encodeURI(proj.model);
    loader.load(modelURL,(gltf)=>{ const root=gltf.scene||gltf.scenes[0]; const box=new THREE.Box3().setFromObject(root); const size=box.getSize(new THREE.Vector3()).length();
      const center=box.getCenter(new THREE.Vector3()); root.position.sub(center); root.scale.setScalar(2/size); scene.add(root);
      (function anim(){ requestAnimationFrame(anim); controls.update(); renderer.render(scene,camera); })();
    },undefined,(err)=>{ console.error("GLB load error:",err); viewer.innerHTML = '<div class="w-full h-full grid place-items-center text-red-300 text-center p-4">Error loading model:<br/><code>'+proj.model+'</code></div>';});
  }
</script></body></html>