<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Project</title><link rel="stylesheet" href="style.css" />
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
  <div class="container">
    <a class="back" href="index.html">← Back</a>
    <h1 id="title"></h1>
    <p id="desc" class="lead"></p>
    <div class="row">
      <div id="viewer" class="viewer"></div>
      <div class="render"><div id="renders" class="slider"></div></div>
    </div>
  </div>
<script>
function qs(k){return new URLSearchParams(location.search).get(k);}
async function loadData(){const r=await fetch('projects.json');return r.json();}
function mountImageSlider(container, images){
  container.classList.add('slider');
  const a=document.createElement('div');a.className='slide-layer active';
  const b=document.createElement('div');b.className='slide-layer';
  const imgA=document.createElement('img'); const imgB=document.createElement('img');
  imgA.src=images[0]||''; imgB.src=images[1]||images[0]||''; a.append(imgA); b.append(imgB); container.append(a,b);
  let idx=0,useA=true; function show(n){ idx=(n+images.length)%images.length; const next=images[idx];
    if(useA){imgB.src=next;a.classList.remove('active');b.classList.add('active');}else{imgA.src=next;b.classList.remove('active');a.classList.add('active');}
    useA=!useA; if(dots){[...dots.children].forEach((d,i)=>d.className='dot'+(i===idx?' active':''));}
  }
  const left=document.createElement('div');left.className='ctrl left';left.textContent='‹';
  const right=document.createElement('div');right.className='ctrl right';right.textContent='›';
  const dots=document.createElement('div');dots.className='dots';
  images.forEach((_,i)=>{const d=document.createElement('span');d.className='dot'+(i===0?' active':'');d.onclick=()=>show(i);dots.appendChild(d);});
  container.append(left,right,dots); left.onclick=()=>show(idx-1); right.onclick=()=>show(idx+1);
}
function mountViewer(container, glb){
  const scene=new THREE.Scene(); scene.background = new THREE.Color(0x0b1220);
  const renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(container.clientWidth,container.clientHeight); container.appendChild(renderer.domElement);
  const camera=new THREE.PerspectiveCamera(45, container.clientWidth/container.clientHeight, .1, 1000); camera.position.set(2.5,1.8,3.2);
  const controls=new THREE.OrbitControls(camera, renderer.domElement); controls.enableDamping=true;
  const hemi=new THREE.HemisphereLight(0xffffff,0x223355,1.1); scene.add(hemi);
  const dir=new THREE.DirectionalLight(0xffffff,1.2); dir.position.set(5,8,5); scene.add(dir);
  const grid=new THREE.GridHelper(8,16,0x445,0x223); grid.material.opacity=.25; grid.material.transparent=true; scene.add(grid);
  const loader=new THREE.GLTFLoader(); loader.load(glb, g=>scene.add(g.scene), undefined, e=>console.warn('Model load error', e));
  function animate(){requestAnimationFrame(animate);controls.update();renderer.render(scene,camera);} animate();
  window.addEventListener('resize',()=>{const w=container.clientWidth,h=container.clientHeight;camera.aspect=w/h;camera.updateProjectionMatrix();renderer.setSize(w,h);});
}
(async ()=>{
  const slug=qs('slug'); const items=await loadData();
  const p=items.find(x=>x.slug===slug)||items[0];
  document.getElementById('title').textContent=p.title;
  document.getElementById('desc').textContent=p.longDescription||p.description||'';
  mountImageSlider(document.getElementById('renders'), p.images||[]);
  if(p.model){ mountViewer(document.getElementById('viewer'), p.model); }
})();
</script>
</body></html>