
<!DOCTYPE html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project</title>
<link rel="stylesheet" href="style.css"/>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.157.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
  <div class="main">
    <a href="index.html" class="sub">&larr; Back</a>
    <h1 id="title">Project</h1>
    <p id="desc" class="sub" style="margin-bottom:24px"></p>

    <div class="grid" style="grid-template-columns:repeat(2, minmax(0,1fr)); gap:22px;">
      <div id="viewer"></div>
      <div id="carousel" class="slider" style="height:420px"></div>
    </div>
  </div>

<script>
function qs(k){return new URL(location.href).searchParams.get(k)||'';}
async function main(){
  const slug = qs('slug');
  const items = await fetch('projects.json').then(r=>r.json());
  const p = items.find(x=>x.slug===slug) || items[0];
  document.getElementById('title').textContent = p.title;
  document.getElementById('desc').textContent = "Interactive 3D preview and image gallery.";

  const car = document.getElementById('carousel');
  (p.images||[]).forEach((src,i)=>{
    const im = document.createElement('img');
    im.src = src; im.className = 'slide'+(i===0?' active':'');
    im.style.cssText = 'width:100%;height:100%;object-fit:cover';
    car.appendChild(im);
  });
  const dots = document.createElement('div'); dots.className='dots';
  dots.innerHTML = (p.images||[]).map((_,i)=>`<span class="dot ${i===0?'active':''}"></span>`).join('');
  car.appendChild(dots);
  let idx=0; if((p.images||[]).length>1){ setInterval(()=>{
    const slides=car.querySelectorAll('.slide'); const ds=car.querySelectorAll('.dot');
    slides[idx].classList.remove('active'); ds[idx].classList.remove('active');
    idx=(idx+1)%slides.length; slides[idx].classList.add('active'); ds[idx].classList.add('active');
  },3500); }

  // viewer
  const wrap = document.getElementById('viewer');
  const w = wrap.clientWidth || 520, h = wrap.clientHeight || 420;
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, w/h, 0.01, 2000);
  camera.position.set(0, 0.4, 3.5);
  const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
  renderer.setPixelRatio(Math.min(devicePixelRatio,2));
  renderer.setSize(w,h); wrap.appendChild(renderer.domElement);
  const hemi = new THREE.HemisphereLight(0xffffff,0x444444, 1.1); scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff,0.9); dir.position.set(3,4,5); scene.add(dir);
  const controls = new THREE.OrbitControls(camera, renderer.domElement); controls.enableDamping=true;

  const grid = new THREE.GridHelper(10,10,0x88aaff,0x224466); grid.material.opacity=.12; grid.material.transparent=true; scene.add(grid);

  const loader = new THREE.GLTFLoader();
  loader.load(p.model, (gltf)=>{
    const root = gltf.scene; scene.add(root);
    const box = new THREE.Box3().setFromObject(root);
    const size = box.getSize(new THREE.Vector3()).length();
    const center = box.getCenter(new THREE.Vector3());
    const fitDist = size/(2*Math.tan(THREE.MathUtils.degToRad(camera.fov)/2));
    camera.position.copy(center).add(new THREE.Vector3(0, size*0.1, fitDist*1.1));
    camera.near = size/100; camera.far=size*100; camera.updateProjectionMatrix();
    controls.target.copy(center); controls.update();
  }, undefined, (e)=>{ console.error('GLB load error:', e); });

  function loop(){ controls.update(); renderer.render(scene,camera); requestAnimationFrame(loop); }
  loop();

  addEventListener('resize',()=>{
    const W = wrap.clientWidth || 520, H = wrap.clientHeight || 420;
    camera.aspect=W/H; camera.updateProjectionMatrix(); renderer.setSize(W,H);
  });
}
main();
</script>
</body></html>
